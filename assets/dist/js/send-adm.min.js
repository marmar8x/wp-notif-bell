!function(){"use strict";var n=jQuery,t=WpnbAdm,e=wpnb_data_obj,a="#wpnb_send_res_form_name_str",r="#wpnb_send_res_form_name_slc",s="#wpnb_send_res_form_data",i="#wpnb_receivers_area",o="#wpnb_res_add_btn",d="#wpnb_res_alert_none",l="#wpnb_act_send",u="#wpnb_send_title",c="#wpnb_send_text",p="#wpnb_send_sender",v="#wpnb_send_text_type",f="#wpnb_send_date",b="#wpnb_send_tags",w="#wpnb_edit_key",_="#wpnb_response_area",m="#wpnb_edit_url",g={res_loop:".wpnb-res-loop",res_close:".wpnb-tp-close",res_count:".wpnb-dt-res-count",tags_count:".wpnb-dt-tags-count",date_status:".wpnb-dt-date-st"},h=function(t,e){var a;void 0===e&&(e=!0),null===(a=n(r).find('option[value="'+t+'"]'))||void 0===a||a.prop("selected",!0),e&&k(t)},y=function(t){n(s).attr("placeholder",t)},x=function(t){n(s).val(t)},k=function(t){var e,a=null===(e=n(r).find('option[value="'+t+'"]'))||void 0===e?void 0:e.data("wpnb-text");y(a||"")};n(r).on("change",(function(t){var e,i=n(t.target).find("option:selected").val();x(""),"user-role"===i?n(s).attr("list","wpnb_send_usr_roles"):n(s).removeAttr("list");var o=function(t){var e,a=null===(e=n(t.target).find("option:selected"))||void 0===e?void 0:e.data("wpnb-ez");return a?a.split(":",2):null}(t);null!==o&&(i=o[0],h(i),x(o[1])),"custom"===i&&(n(r).hide(),n(a).fadeIn(),y((null===(e=n(t.target).find('option[value="custom"]'))||void 0===e?void 0:e.data("wpnb-text"))||"")),k(i)})),n(a).on("dblclick",(function(){n(r).fadeIn(),n(a).hide(),h("user-id")})),n(a).on("change input",(function(){var e=n(a).val();n(a).val(t.slugify(e))})),n(b).on("change input",(function(){var e=n(b).val(),a=t.slugify(e,",").replace(/\,+/g,",");n(b).val(a);var r=a.split(","),s=0===(r=(r=r.filter((function(n){return""!==n}))).filter((function(n,t,e){return!t||n!=e[t-1]}))).length?"[Optional]":"["+r.length+"]";n(g.tags_count).html(s)}));var A=function(e){var a=function(n,t){return'<div class="cell:100 cell-sm:50 cell-md:33 wpnb-res-loop" data-wpnb-res-id="'+n+'" data-wpnb-res-name="'+t.name+'" data-wpnb-res-data="'+t.data+'">\n        <div class="wpnb-ad-res-box">\n            <div class="wpnb-hide-more wpnb-w-100">\n                <span class="wpnb-tp-title">'+t.name+'</span>\n                <span class="wpnb-tp-text">\n                    '+t.data+'\n                </span>\n            </div>\n            \n            <span style="flex-grow: 1; text-align: end;">\n                <button class="wpnb-tp-close" data-wpnb-res-close-id="'+n+'">\n                    &times;\n                </button>\n            </span>\n        </div>\n    </div>'}(t.randomStr(12),e),r=null;(""===e.name?r="Without any name for receiver?":/^[a-zA-Z0-9-]+$/.test(e.name)||(r='Receiver name is unvalid! Use (a-zA-Z0-9) and "-" for enter receiver name.'),""===e.data&&(r="Please fill the data field first."),null===r)?(n(i).append(a),n(s).val("")):alert("Error: "+r)};n(o).on("click",(function(){var t=function(t){return"custom"===t?n(a).val():t}(n(r).val()),e=n(s).val();P(t,e)?I("The receiver is duplicate!"):A({name:t,data:e})})),n(i).on("DOMNodeInserted DOMNodeRemoved",(function(t){var e,a=t.type,r=t.target;if(n(r).hasClass(g.res_loop.slice(1))){n(r).find(g.res_close).on("click",(function(t){var e,a;e=n(t.target).data("wpnb-res-close-id"),null===(a=n('[data-wpnb-res-id="'+e+'"]'))||void 0===a||a.remove()}));var s=document.querySelectorAll(g.res_loop).length,i="DOMNodeInserted"===a?s:s-1;n(g.res_count).text(0===i?"":"("+i+")"),e=0===i,n(d).toggle(e)}})),n(f).on("input change",(function(t){var e=t.target;n(e).val(n(e).val().slice(0,19)),""===n(e).val()?n(g.date_status).html("Empty: Auto fill"):D(n(e).val())?n(g.date_status).html(""):n(g.date_status).html("Incorrect")})),n(p).on("input change",(function(e){n(e.target).val(t.slugify(n(e.target).val()))})),window.addEventListener("load",(function(){var n;h("user-id");var t=[f,p,b],e=new Event("change");for(var a of t)null===(n=document.querySelector(a))||void 0===n||n.dispatchEvent(e);E()}));var E=function(){var t=n(i).data("wpnb-value");if(Array.isArray(t)&&0!==t.length)for(var e of t){var a={name:e.name,data:e.data};A(a)}};n(l).click((function(t){if(R)I("Please wait until the notif is sent.");else{var e=n(t.target).data("wpnb-action"),a="send";e&&"edit"===e&&document.querySelector(w)&&(a="edit"),R=!0;var r={sender:n(p).val(),title:n(u).val(),text:n(c).val(),format:n(v).val(),date:n(f).val(),tags:n(b).val().split(",").filter((function(n){return""!==n})),receivers:T()},s=[];if(""===r.sender&&s.push("Notif sender is required!"),""===r.title&&s.push("Notif title is required!"),""===r.text&&s.push("Can not send notif without content!"),""===r.format&&s.push("Please select notif content format!"),0===r.receivers.length&&s.push("You can not send notif without any receiver."),""===r.date||D(r.date)||s.push("Notif date must entered as yyyy-mm-dd hh:ii:ss or just leave it blank for auto fill."),0===s.length)"send"===a?S(r):j(r),R=!1;else{R=!1;var i=s.map((function(n){return"- "+n})).join("\n");I("Please fix the following error(s):\n"+i)}}}));var N=function(t){var e=n(l);t?e.removeAttr("disabled"):e.attr("disabled","disabled")},j=function(t){var a=e.ajax_url,r=e.security,s=n(w).val();q(!1),N(!1),n.ajax({type:"post",dataType:"json",url:a,data:{notif:t,action:"wpnb_edit_notif",security:r,key:s},success:function(n){n.success?O(n.data.status,n,n.data.errors,n.data.data):O("None",n)},error:function(n){O("Error",n)}}).done((function(){N(!0)}))},S=function(t){var a=e.ajax_url,r=e.security;q(!0),N(!1),n.ajax({type:"post",dataType:"json",url:a,data:{notif:t,action:"wpnb_send_notif",security:r},success:function(t){if(t.success)return"sent"===t.data.status&&function(){var t=[u,f,p,c,b];for(var e of t)n(e).val("");n(v).val(n(v).find("option:first").val()),n(i).find(g.res_loop).remove()}(),void O(t.data.status,t,t.data.errors,t.data.data);O("None",t)},error:function(n){O("Error",n)}}).done((function(){N(!0)}))},q=function(t){var e=t?"Sending notification ...":"Updating notification ...";n(_).html('\n        <div class="wpnb-msg-sent wpnb-w-100 wpnb-alert wpnb-alert-bg-primary wpnb-mt-4">\n            '+e+"\n        </div>\n    ")},O=function(t,e,a,r){var s;void 0===e&&(e={}),void 0===a&&(a=[]),void 0===r&&(r=[]);var i=n(_),o="sent"===t||"updated"===t?"success":"danger",d="",u="";(d="edit"===n(l).data("wpnb-action")?"updated"===t?"Result: The notification was updated.":"Result: An error occurred while updating.":"sent"===t?"Result: The notification was sent.":"Result: An error occurred while sending.","sent"===t)&&(u+='\n            <a href="'+(null===(s=n(m))||void 0===s?void 0:s.val().replace("{key}",r.key))+'">\n                Edit notif\n            </a>\n        ');var c='\n        <div class="wpnb-msg-sent wpnb-w-100 wpnb-alert wpnb-alert-bg-'+o+' wpnb-mt-4">\n            '+d+"\n            "+u+"\n        </div>\n    ";c+="None"!==t?'\n            <div class="wpnb-msg-sent wpnb-w-100 wpnb-alert wpnb-alert-cl-black wpnb-mt-4">\n                Sender/Updater result: '+t+" <br />\n                Data: "+JSON.stringify(r)+" <br />\n                Errors: "+JSON.stringify(a)+"\n            </div>\n        ":'\n            <div class="wpnb-msg-sent wpnb-w-100 wpnb-alert wpnb-alert-cl-black wpnb-mt-4">\n                Error code: '+e.data.error+" <br />\n                Error msg: "+e.data.msg+" <br />\n            </div>\n        ",i.html(c)},R=!1,I=function(n){alert(n)},T=function(){var t=n(g.res_loop),e=[];return t.each((function(n){var a={name:t.eq(n).data("wpnb-res-name"),data:t.eq(n).data("wpnb-res-data")};e.push(a)})),e},D=function(n){return!!/[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]) (2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9]/.exec(n)},P=function(n,t){var e=T();for(var a of e)if(a.name===n&&a.data===t)return!0;return!1}}();
//# sourceMappingURL=send-adm.min.js.map
